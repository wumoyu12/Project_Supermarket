import sys
import os
from os import path

# Global variable to store the filename
filename = ""

def main():
    AskUser()

def AskUser():
    adminuser = input("1-Sign in\n2-Sign up\n")
    match(adminuser):
        case "1":
            AskUserInfo()
        case "2":
            CreateAccount()
        case _:
            print("It's an invalid selection, please try again.")
            AskUser()

def CreateAccount():
    username = input("Please create a username: ")
    global filename
    filename = username + ".doc"
    FileConnectivity()
    if fileexist == "true":
        print("This username has been used, please create another username.")
        CreateAccount()
    else:
        AskPassword()

def AskPassword():
    password = input("Please create a password: ")
    repassword = input("Please repeat your password: ")
    if password == repassword:
        print("Account created!")
    else:
        print("Passwords do not match. Please try again.")
        AskPassword()

def AskUserInfo():
    global filename
    username = input("Please enter username: ")
    password = input("Please enter password: ")

    if username == "" or password == "":
        print("You have entered incorrect username or password, please try again.")
        AskUserInfo()
    else:
        filename = username + ".doc"
        FileConnectivity()

def FileConnectivity():
    global fileexist
    fileDir = os.path.dirname(os.path.realpath("__file__"))
    if path.exists(filename):
        fileexist = "true"
    else:
        fileexist = "false"

def AskNewUser():
    new = input("Are you a new user? If yes, enter 1, if no, enter 2: ")
    match(new):
        case "1":
            AskEdit()
        case "2":
            AskDepartments()
        case _:
            print("It's an invalid selection, please try again.")

def AskDepartments():
    global whichchscreen
    departments = ("Welcome to Supermarket, choose one of the Departments you are interested in.\n"
                   "1-Fruit\n2-Poultry\n3-Meat\n4-Beverage\n5-Frozen Foods\n6-Dietary Food (Vegetables, Salad)\n"
                   "7-Kosher\n8-Halal\n")
    whichchscreen = input(departments)
    CheckDepartments()

def CheckDepartments():
    global whichchscreen
    fileDir = os.path.dirname(os.path.realpath("__file__"))
    
    # Selecting the path based on department choice
    match(whichchscreen):
        case "1":
            filepath = os.path.join(fileDir, "Fruit.py")
        case "2":
            filepath = os.path.join(fileDir, "Poultry.py")
        case "3":
            filepath = os.path.join(fileDir, "Meat.py")
        case "4":
            filepath = os.path.join(fileDir, "Beverage.py")
        case "5":
            filepath = os.path.join(fileDir, "FrozenFoods.py")
        case "6":
            filepath = os.path.join(fileDir, "DietaryFood.py")
        case "7":
            filepath = os.path.join(fileDir, "Kosher.py")
        case "8":
            filepath = os.path.join(fileDir, "Halal.py")
        case _:
            print("It's an invalid selection, please try again.")
            main()
            return  # Exit CheckDepartments if invalid input
    ExecuteDepartmentFile(filepath)

def ExecuteDepartmentFile(filepath):
    # Ensure the file exists before trying to execute it
    if os.path.exists(filepath):
        filenamepath = {
            "__file__": filepath,
            "__name__": "__main__",
        }
        with open(filepath, "rb") as file:
            exec(compile(file.read(), filepath, "exec"), filenamepath)
        main()  # Call main again after executing the department file
    else:
        print(f"The department file at {filepath} does not exist.")
        main()

if __name__ == "__main__":
    main()
